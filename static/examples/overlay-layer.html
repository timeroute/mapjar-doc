<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapjar è¦†ç›–å±‚ç¤ºä¾‹</title>
  <style>
    body { 
      margin: 0; 
      padding: 0; 
      overflow: hidden; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    }
    #map { 
      width: 100vw; 
      height: 100vh; 
    }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      max-width: 300px;
    }
    #info h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      color: #333;
    }
    #info p {
      margin: 0;
      font-size: 14px;
      color: #666;
      line-height: 1.5;
    }
    .city-list {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #eee;
    }
    .city-btn {
      display: inline-block;
      margin: 4px;
      padding: 6px 12px;
      background: #1890ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
    }
    .city-btn:hover {
      background: #40a9ff;
    }
    .marker {
      position: relative;
      text-align: center;
    }
    .marker-content {
      background: #1890ff;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(24, 144, 255, 0.4);
    }
    .marker-arrow {
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 10px solid #1890ff;
      margin: 0 auto;
    }
    .popup {
      background: white;
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      min-width: 200px;
      max-width: 300px;
    }
    .popup h3 { 
      margin: 0 0 8px 0; 
      font-size: 16px;
      color: #333;
    }
    .popup p { 
      margin: 0 0 4px 0; 
      color: #666; 
      font-size: 14px;
      line-height: 1.5;
    }
    .popup-close {
      margin-top: 12px;
      padding: 6px 16px;
      background: #f5f5f5;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      width: 100%;
      transition: background 0.2s;
    }
    .popup-close:hover {
      background: #e8e8e8;
    }
  </style>
</head>
<body>
  <canvas id="map"></canvas>
  
  <div id="info">
    <h3>ğŸ—ºï¸ è¦†ç›–å±‚ç¤ºä¾‹</h3>
    <p>ç‚¹å‡»åœ°å›¾ä»»æ„ä½ç½®æ˜¾ç¤ºå¼¹çª—ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹åŸå¸‚æ ‡æ³¨ã€‚</p>
    <div class="city-list">
      <button class="city-btn" data-city="beijing">åŒ—äº¬</button>
      <button class="city-btn" data-city="shanghai">ä¸Šæµ·</button>
      <button class="city-btn" data-city="guangzhou">å¹¿å·</button>
      <button class="city-btn" data-city="shenzhen">æ·±åœ³</button>
    </div>
  </div>
  
  <script type="module">
    import { MapEngine, TileLayer, OverlayLayer } from 'https://unpkg.com/mapjar@latest/dist/mapjar.js';
    
    // åˆ›å»ºåœ°å›¾å¼•æ“
    const engine = new MapEngine('#map', {
      center: [110, 35],
      zoom: 4,
    });
    
    // æ·»åŠ åº•å›¾
    const tileLayer = new TileLayer(
      'base', 
      'https://tile.openstreetmap.org/{z}/{x}/{y}.png'
    );
    engine.addLayer(tileLayer);
    
    // åˆ›å»ºæ ‡æ³¨å›¾å±‚
    const markerLayer = new OverlayLayer('marker');
    markerLayer.setZIndex(50);
    engine.addLayer(markerLayer);
    
    // åˆ›å»ºå¼¹çª—å›¾å±‚
    const popupLayer = new OverlayLayer('popup');
    popupLayer.setZIndex(100);
    engine.addLayer(popupLayer);
    
    // åŸå¸‚æ•°æ®
    const cities = {
      beijing: { name: 'åŒ—äº¬', lon: 116.4074, lat: 39.9042, desc: 'ä¸­å›½é¦–éƒ½ï¼Œæ”¿æ²»æ–‡åŒ–ä¸­å¿ƒ', color: '#1890ff' },
      shanghai: { name: 'ä¸Šæµ·', lon: 121.4737, lat: 31.2304, desc: 'ç»æµé‡‘èä¸­å¿ƒï¼Œå›½é™…å¤§éƒ½å¸‚', color: '#52c41a' },
      guangzhou: { name: 'å¹¿å·', lon: 113.2644, lat: 23.1291, desc: 'å—æ–¹é—¨æˆ·ï¼Œåƒå¹´å•†éƒ½', color: '#faad14' },
      shenzhen: { name: 'æ·±åœ³', lon: 114.0579, lat: 22.5431, desc: 'æ”¹é©å¼€æ”¾çª—å£ï¼Œç§‘æŠ€åˆ›æ–°ä¹‹åŸ', color: '#f5222d' },
    };
    
    // åˆ›å»ºæ ‡æ³¨å…ƒç´ 
    function createMarker(city) {
      const marker = document.createElement('div');
      marker.className = 'marker';
      marker.innerHTML = `
        <div class="marker-content" style="background: ${city.color};">
          ${city.name}
        </div>
        <div class="marker-arrow" style="border-top-color: ${city.color};"></div>
      `;
      return marker;
    }
    
    // åˆ›å»ºå¼¹çª—å…ƒç´ 
    function createPopup(lon, lat, city) {
      const popup = document.createElement('div');
      popup.className = 'popup';
      
      if (city) {
        popup.innerHTML = `
          <h3>${city.name}</h3>
          <p><strong>ç»åº¦ï¼š</strong>${lon.toFixed(4)}Â°</p>
          <p><strong>çº¬åº¦ï¼š</strong>${lat.toFixed(4)}Â°</p>
          <p style="margin-top: 8px;">${city.desc}</p>
          <button class="popup-close">å…³é—­</button>
        `;
      } else {
        popup.innerHTML = `
          <h3>ğŸ“ ç‚¹å‡»ä½ç½®</h3>
          <p><strong>ç»åº¦ï¼š</strong>${lon.toFixed(4)}Â°</p>
          <p><strong>çº¬åº¦ï¼š</strong>${lat.toFixed(4)}Â°</p>
          <button class="popup-close">å…³é—­</button>
        `;
      }
      
      popup.querySelector('.popup-close').addEventListener('click', () => {
        popupLayer.clearOverlay();
      });
      
      return popup;
    }
    
    // æ˜¾ç¤ºåŸå¸‚æ ‡æ³¨
    function showCityMarker(cityKey) {
      const city = cities[cityKey];
      
      // æ˜¾ç¤ºæ ‡æ³¨
      markerLayer.setOverlay({
        element: createMarker(city),
        position: {
          lon: city.lon,
          lat: city.lat,
          anchor: [0.5, 1.0],
        },
        properties: { city: cityKey },
      });
      
      // é£åˆ°åŸå¸‚
      engine.flyTo(city.lon, city.lat, 10, { duration: 1500 });
      
      // 1ç§’åæ˜¾ç¤ºå¼¹çª—
      setTimeout(() => {
        popupLayer.setOverlay({
          element: createPopup(city.lon, city.lat, city),
          position: {
            lon: city.lon,
            lat: city.lat,
            offset: [0, -50],
            anchor: [0.5, 1.0],
          },
        });
      }, 1500);
    }
    
    // åŸå¸‚æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.city-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const cityKey = btn.dataset.city;
        showCityMarker(cityKey);
      });
    });
    
    // åœ°å›¾ç‚¹å‡»äº‹ä»¶
    engine.on('click', (event) => {
      // æ¸…é™¤æ ‡æ³¨
      markerLayer.clearOverlay();
      
      // æ˜¾ç¤ºå¼¹çª—
      popupLayer.setOverlay({
        element: createPopup(event.lon, event.lat),
        position: {
          lon: event.lon,
          lat: event.lat,
          offset: [0, -20],
          anchor: [0.5, 1.0],
        },
      });
    });
    
    // åˆå§‹æ˜¾ç¤ºåŒ—äº¬
    setTimeout(() => {
      showCityMarker('beijing');
    }, 500);
  </script>
</body>
</html>
